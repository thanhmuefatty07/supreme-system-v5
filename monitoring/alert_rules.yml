# Alert Rules for Supreme System V5
# Production alerting configuration

groups:
  - name: supreme_system_critical
    interval: 30s
    rules:
    - alert: HighErrorRate
      expr: |
        rate(http_requests_total{status=~"5.."}[5m]) 
        / 
        rate(http_requests_total[5m]) > 0.05
      for: 5m
      labels:
        severity: critical
        team: devops
      annotations:
        summary: "High error rate detected"
        description: "Error rate is {{ $value | humanizePercentage }} (threshold: 5%)"
        runbook: "https://wiki.example.com/runbooks/high-error-rate"

    - alert: ServiceDown
      expr: up{job="supreme-system-v5"} == 0
      for: 2m
      labels:
        severity: critical
        team: devops
      annotations:
        summary: "Service is down"
        description: "{{ $labels.instance }} has been down for 2 minutes"

    - alert: LowTestCoverage
      expr: test_coverage_percent < 80
      for: 10m
      labels:
        severity: warning
        team: qa
      annotations:
        summary: "Test coverage below threshold"
        description: "Coverage is {{ $value }}% (threshold: 80%)"

  - name: supreme_system_performance
    interval: 60s
    rules:
    - alert: HighLatency
      expr: |
        histogram_quantile(0.95, 
          rate(http_request_duration_seconds_bucket[5m])
        ) > 1
      for: 5m
      labels:
        severity: warning
        team: performance
      annotations:
        summary: "High request latency"
        description: "95th percentile latency is {{ $value }}s (threshold: 1s)"

    - alert: HighMemoryUsage
      expr: |
        container_memory_usage_bytes{pod=~"supreme-system.*"} 
        / 
        container_spec_memory_limit_bytes > 0.9
      for: 5m
      labels:
        severity: warning
        team: devops
      annotations:
        summary: "High memory usage"
        description: "Memory usage is {{ $value | humanizePercentage }} of limit"

    - alert: HighCPUUsage
      expr: |
        rate(container_cpu_usage_seconds_total{pod=~"supreme-system.*"}[5m]) > 0.8
      for: 10m
      labels:
        severity: warning
        team: devops
      annotations:
        summary: "High CPU usage"
        description: "CPU usage is {{ $value | humanizePercentage }}"

  - name: supreme_system_security
    interval: 30s
    rules:
    - alert: ZeroTrustViolation
      expr: rate(zero_trust_access_denied_total[5m]) > 0
      for: 1m
      labels:
        severity: critical
        team: security
      annotations:
        summary: "Zero trust access violations detected"
        description: "{{ $value }} access attempts were denied in last 5 minutes"

    - alert: AnomalousAuthActivity
      expr: rate(auth_failed_total[5m]) > 10
      for: 2m
      labels:
        severity: high
        team: security
      annotations:
        summary: "Anomalous authentication activity"
        description: "{{ $value }} failed auth attempts per second"

    - alert: QuantumKeyRotationOverdue
      expr: time() - quantum_key_rotation_timestamp > 86400*30  # 30 days
      for: 1h
      labels:
        severity: warning
        team: security
      annotations:
        summary: "Quantum keys need rotation"
        description: "Keys have not been rotated in 30+ days"
