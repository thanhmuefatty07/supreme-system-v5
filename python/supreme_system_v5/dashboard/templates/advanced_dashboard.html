<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supreme System V5 - Advanced Trading Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .metric-change-positive {
            color: #10b981;
        }

        .metric-change-negative {
            color: #ef4444;
        }

        .metric-change-neutral {
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-chart-line text-2xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Supreme System V5</h1>
                        <p class="text-sm opacity-90">Advanced AI-Powered Trading Dashboard</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-sm">LIVE</span>
                    </div>

                    <div id="connection-status" class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full" id="connection-dot"></div>
                        <span class="text-sm" id="connection-text">Connected</span>
                    </div>

                    <div class="text-right">
                        <div class="text-sm opacity-90">Last Update</div>
                        <div class="text-sm font-semibold" id="last-update">00:00:00</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="container mx-auto px-4 py-6 space-y-6">
        <!-- Key Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Portfolio Value -->
            <div class="bg-white rounded-lg card-shadow p-6 fade-in">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Portfolio Value</p>
                        <p class="text-2xl font-bold text-gray-900" id="portfolio-value">$10,000.00</p>
                        <p class="text-sm" id="portfolio-change">
                            <span class="metric-change-positive">+0.00 (+0.00%)</span>
                        </p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-full">
                        <i class="fas fa-wallet text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Daily P&L -->
            <div class="bg-white rounded-lg card-shadow p-6 fade-in">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Daily P&L</p>
                        <p class="text-2xl font-bold text-gray-900" id="daily-pnl">$0.00</p>
                        <p class="text-sm" id="daily-pnl-percent">
                            <span class="metric-change-neutral">+0.00%</span>
                        </p>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-full">
                        <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Active Positions -->
            <div class="bg-white rounded-lg card-shadow p-6 fade-in">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Positions</p>
                        <p class="text-2xl font-bold text-gray-900" id="active-positions">0</p>
                        <p class="text-sm text-gray-500" id="position-details">No active positions</p>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-full">
                        <i class="fas fa-briefcase text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- AI Confidence -->
            <div class="bg-white rounded-lg card-shadow p-6 fade-in">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm font-medium text-gray-600">AI Confidence</p>
                        <p class="text-2xl font-bold text-gray-900" id="ai-confidence">85.3%</p>
                        <p class="text-sm text-gray-500" id="ai-status">High confidence signals</p>
                    </div>
                    <div class="p-3 bg-indigo-100 rounded-full">
                        <i class="fas fa-brain text-indigo-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Portfolio Chart -->
            <div class="lg:col-span-2 bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Portfolio Performance</h3>
                    <div class="flex space-x-2">
                        <button class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded" onclick="changeChartPeriod(1)">1H</button>
                        <button class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded" onclick="changeChartPeriod(6)">6H</button>
                        <button class="px-3 py-1 text-sm bg-blue-500 text-white rounded" onclick="changeChartPeriod(24)">24H</button>
                    </div>
                </div>
                <canvas id="portfolioChart" height="300"></canvas>
            </div>

            <!-- System Stats -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">System Performance</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">CPU Usage</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" id="cpu-bar" style="width: 0%"></div>
                            </div>
                            <span class="text-sm font-medium" id="cpu-percent">0%</span>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Memory Usage</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" id="memory-bar" style="width: 0%"></div>
                            </div>
                            <span class="text-sm font-medium" id="memory-percent">0%</span>
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Network</span>
                        <span class="text-sm font-medium" id="network-usage">0 MB/s</span>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Active Clients</span>
                        <span class="text-sm font-medium" id="active-clients">1</span>
                    </div>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">Data Quality</span>
                        <span class="text-sm font-medium" id="data-quality">98.5%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Activity & AI Insights -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Recent Trades -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">Recent Trades</h3>
                    <button class="text-blue-500 hover:text-blue-700 text-sm" onclick="refreshTrades()">
                        <i class="fas fa-refresh mr-1"></i>Refresh
                    </button>
                </div>

                <div class="space-y-3 max-h-80 overflow-y-auto" id="trades-list">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-spinner fa-spin text-xl mb-2"></i>
                        <p>Loading trades...</p>
                    </div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-900">AI Insights</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-600">Live</span>
                    </div>
                </div>

                <div class="space-y-4" id="ai-insights">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-brain text-xl mb-2"></i>
                        <p>Waiting for AI insights...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="bg-white rounded-lg card-shadow p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Performance Metrics</h3>
                <div class="flex space-x-4 text-sm">
                    <div class="flex items-center space-x-1">
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        <span>Win Rate: <span id="win-rate">65.2%</span></span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        <span>Sharpe: <span id="sharpe-ratio">2.1</span></span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <span>Max DD: <span id="max-drawdown">-2.3%</span></span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-900" id="total-trades">127</div>
                    <div class="text-sm text-gray-600">Total Trades</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="profitable-trades">83</div>
                    <div class="text-sm text-gray-600">Profitable</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-900" id="avg-trade-duration">8.5m</div>
                    <div class="text-sm text-gray-600">Avg Duration</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-900" id="best-trade">+$127.43</div>
                    <div class="text-sm text-gray-600">Best Trade</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    <i class="fas fa-copyright mr-1"></i>2024 Supreme System V5 - S+ Grade Performance
                </div>
                <div class="flex space-x-4 text-sm text-gray-600">
                    <span><i class="fas fa-server mr-1"></i>Local: i3-4GB</span>
                    <span><i class="fas fa-cloud mr-1"></i>Cloud: Oracle ARM64</span>
                    <span><i class="fas fa-memory mr-1"></i><span id="memory-usage-footer">1.2GB</span></span>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Global variables
        let portfolioChart;
        let socket;
        let lastMetrics = {};
        let chartData = { timestamps: [], values: [], pnl: [] };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initWebSocket();
            initCharts();
            updateLastUpdate();
            setInterval(updateLastUpdate, 1000);
        });

        // WebSocket connection
        function initWebSocket() {
            socket = io();

            socket.on('connect', function() {
                updateConnectionStatus(true);
                console.log('Connected to dashboard server');
            });

            socket.on('disconnect', function() {
                updateConnectionStatus(false);
                console.log('Disconnected from dashboard server');
            });

            socket.on('initial_data', function(data) {
                console.log('Received initial data:', data);
                updateDashboard(data);
            });

            socket.on('dashboard_update', function(data) {
                updateDashboard(data);
            });

            socket.on('chart_data_update', function(data) {
                updateChart(data.data);
            });
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            const dot = document.getElementById('connection-dot');
            const text = document.getElementById('connection-text');

            if (connected) {
                dot.className = 'w-3 h-3 bg-green-400 rounded-full';
                text.textContent = 'Connected';
            } else {
                dot.className = 'w-3 h-3 bg-red-400 rounded-full animate-pulse';
                text.textContent = 'Disconnected';
            }
        }

        // Update last update time
        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('last-update').textContent =
                now.toLocaleTimeString();
        }

        // Initialize charts
        function initCharts() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');

            portfolioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Portfolio Value',
                        data: [],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Daily P&L',
                        data: [],
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Portfolio: $${context.parsed.y.toFixed(2)}`;
                                    } else {
                                        return `P&L: $${context.parsed.y.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Portfolio Value ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Daily P&L ($)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }

        // Update dashboard with new data
        function updateDashboard(data) {
            if (data.current_metrics) {
                updateMetrics(data.current_metrics);
            }

            if (data.system_stats) {
                updateSystemStats(data.system_stats);
            }

            if (data.chart_data) {
                updateChart(data.chart_data);
            }

            if (data.recent_trades) {
                updateTrades(data.recent_trades);
            }

            if (data.ai_insights) {
                updateAIInsights(data.ai_insights);
            }

            updateLastUpdate();
        }

        // Update key metrics
        function updateMetrics(metrics) {
            // Store previous values for change calculation
            const prevValue = lastMetrics.portfolio_value || metrics.portfolio_value;
            const prevPnl = lastMetrics.daily_pnl || metrics.daily_pnl;

            // Update portfolio value
            document.getElementById('portfolio-value').textContent =
                `$${metrics.portfolio_value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

            // Update portfolio change
            const valueChange = metrics.portfolio_value - prevValue;
            const valueChangePercent = (valueChange / prevValue) * 100;
            const changeElement = document.getElementById('portfolio-change').querySelector('span');

            changeElement.textContent = `${valueChange >= 0 ? '+' : ''}${valueChange.toFixed(2)} (${valueChangePercent >= 0 ? '+' : ''}${valueChangePercent.toFixed(2)}%)`;
            changeElement.className = valueChange >= 0 ? 'metric-change-positive' : 'metric-change-negative';

            // Update daily P&L
            document.getElementById('daily-pnl').textContent =
                `$${metrics.daily_pnl.toFixed(2)}`;

            const pnlPercentElement = document.getElementById('daily-pnl-percent').querySelector('span');
            pnlPercentElement.textContent = `${metrics.daily_pnl_percent >= 0 ? '+' : ''}${metrics.daily_pnl_percent.toFixed(2)}%`;
            pnlPercentElement.className = metrics.daily_pnl_percent >= 0 ? 'metric-change-positive' :
                                         metrics.daily_pnl_percent < 0 ? 'metric-change-negative' : 'metric-change-neutral';

            // Update active positions
            document.getElementById('active-positions').textContent = metrics.active_positions;

            // Update AI confidence
            document.getElementById('ai-confidence').textContent = `${(metrics.ai_confidence * 100).toFixed(1)}%`;

            // Update performance metrics
            if (metrics.win_rate !== undefined) {
                document.getElementById('win-rate').textContent = `${(metrics.win_rate).toFixed(1)}%`;
            }
            if (metrics.sharpe_ratio !== undefined) {
                document.getElementById('sharpe-ratio').textContent = metrics.sharpe_ratio.toFixed(1);
            }
            if (metrics.max_drawdown !== undefined) {
                document.getElementById('max-drawdown').textContent = `${(metrics.max_drawdown).toFixed(1)}%`;
            }
            if (metrics.total_trades !== undefined) {
                document.getElementById('total-trades').textContent = metrics.total_trades;
            }
            if (metrics.avg_trade_duration !== undefined) {
                document.getElementById('avg-trade-duration').textContent = `${metrics.avg_trade_duration}m`;
            }

            lastMetrics = metrics;
        }

        // Update system stats
        function updateSystemStats(stats) {
            document.getElementById('cpu-percent').textContent = `${stats.cpu_usage.toFixed(1)}%`;
            document.getElementById('cpu-bar').style.width = `${Math.min(stats.cpu_usage, 100)}%`;

            const memoryPercent = (stats.memory_usage / (stats.memory_available_mb + stats.memory_usage)) * 100;
            document.getElementById('memory-percent').textContent = `${stats.memory_usage.toFixed(1)}%`;
            document.getElementById('memory-bar').style.width = `${Math.min(memoryPercent, 100)}%`;

            if (stats.network_usage_mb !== undefined) {
                document.getElementById('network-usage').textContent = `${stats.network_usage_mb.toFixed(1)} MB`;
            }

            if (stats.dashboard_memory_mb !== undefined) {
                document.getElementById('memory-usage-footer').textContent = `${stats.dashboard_memory_mb.toFixed(1)}GB`;
            }
        }

        // Update chart
        function updateChart(data) {
            if (!portfolioChart || !data) return;

            // Update chart data
            portfolioChart.data.labels = data.map(d => new Date(d.timestamp * 1000).toLocaleTimeString());
            portfolioChart.data.datasets[0].data = data.map(d => d.portfolio_value);
            portfolioChart.data.datasets[1].data = data.map(d => d.daily_pnl);

            portfolioChart.update('none'); // Update without animation for performance
        }

        // Update trades list
        function updateTrades(trades) {
            const tradesList = document.getElementById('trades-list');

            if (!trades || trades.length === 0) {
                tradesList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-xl mb-2"></i>
                        <p>No recent trades</p>
                    </div>
                `;
                return;
            }

            tradesList.innerHTML = trades.slice(0, 10).map(trade => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center ${
                            trade.side === 'BUY' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
                        }">
                            <i class="fas ${trade.side === 'BUY' ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
                        </div>
                        <div>
                            <div class="font-medium">${trade.symbol}</div>
                            <div class="text-sm text-gray-500">${trade.side} ${trade.quantity} @ $${trade.price.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-medium ${trade.pnl >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(2)}
                        </div>
                        <div class="text-sm text-gray-500">${new Date(trade.timestamp * 1000).toLocaleTimeString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // Update AI insights
        function updateAIInsights(insights) {
            const insightsDiv = document.getElementById('ai-insights');

            if (!insights || insights.length === 0) {
                insightsDiv.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-brain text-xl mb-2"></i>
                        <p>Waiting for AI insights...</p>
                    </div>
                `;
                return;
            }

            insightsDiv.innerHTML = insights.map(insight => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-medium text-gray-900">${insight.type.replace('_', ' ').toUpperCase()}</span>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            insight.confidence > 0.8 ? 'bg-green-100 text-green-800' :
                            insight.confidence > 0.6 ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${(insight.confidence * 100).toFixed(0)}%
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">${insight.symbol}</div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium ${
                            insight.recommendation === 'BUY' ? 'text-green-600' :
                            insight.recommendation === 'SELL' ? 'text-red-600' :
                            'text-gray-600'
                        }">${insight.recommendation}</span>
                        <span class="text-sm text-gray-500">
                            ${new Date(insight.timestamp * 1000).toLocaleTimeString()}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Change chart period
        function changeChartPeriod(hours) {
            // Update button styles
            document.querySelectorAll('[onclick^="changeChartPeriod"]').forEach(btn => {
                btn.className = 'px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded';
            });
            event.target.className = 'px-3 py-1 text-sm bg-blue-500 text-white rounded';

            // Request new chart data
            socket.emit('request_chart_data', { hours: hours });
        }

        // Refresh trades
        function refreshTrades() {
            // This would trigger a refresh of trades data
            console.log('Refreshing trades...');
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Dashboard error:', e.error);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (socket) {
                socket.disconnect();
            }
        });
    </script>
</body>
</html>
