groups:
  - name: supreme_system_v5_alerts
    rules:
      # ===== SYSTEM HEALTH ALERTS =====
      - alert: SupremeSystemDown
        expr: up{job="supreme-system-v5"} == 0
        for: 30s
        labels:
          severity: critical
          service: supreme-system-v5
        annotations:
          summary: "Supreme System V5 is down"
          description: "Supreme System V5 has been down for more than 30 seconds."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/supreme-system-down"

      - alert: SupremeSystemHighErrorRate
        expr: rate(http_requests_total{job="supreme-system-v5", status=~"5.."}[5m]) / rate(http_requests_total{job="supreme-system-v5"}[5m]) > 0.05
        for: 2m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | printf \"%.2f\" }}% over the last 5 minutes."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-error-rate"

      - alert: SupremeSystemHighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="supreme-system-v5"}[5m])) > 0.020
        for: 2m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "High latency detected"
          description: "95th percentile latency is {{ $value | printf \"%.3f\" }}s, exceeding 20ms SLA."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-latency"

      # ===== PERFORMANCE ALERTS =====
      - alert: SupremeSystemHighMemoryUsage
        expr: process_resident_memory_bytes{job="supreme-system-v5"} / 1024 / 1024 > 15
        for: 1m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value | printf \"%.1f\" }}MB, exceeding 15MB limit."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-memory-usage"

      - alert: SupremeSystemHighCPUUsage
        expr: rate(process_cpu_user_seconds_total{job="supreme-system-v5"}[5m]) * 100 > 85
        for: 2m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is {{ $value | printf \"%.1f\" }}%, exceeding 85% limit."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-cpu-usage"

      # ===== TRADING-SPECIFIC ALERTS =====
      - alert: SupremeSystemLowWinRate
        expr: supreme_trading_win_rate < 0.65
        for: 5m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "Low trading win rate"
          description: "Trading win rate is {{ $value | printf \"%.1f\" }}%, below 65% threshold."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/low-win-rate"

      - alert: SupremeSystemHighSlippage
        expr: supreme_trading_slippage_p95 > 0.001
        for: 2m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "High trading slippage"
          description: "95th percentile slippage is {{ $value | printf \"%.4f\" }}, exceeding 0.1%."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-slippage"

      - alert: SupremeSystemStaleSignals
        expr: time() - supreme_signal_last_timestamp > 300
        for: 1m
        labels:
          severity: critical
          service: supreme-system-v5
        annotations:
          summary: "Stale trading signals"
          description: "No trading signals generated for {{ $value | printf \"%.0f\" }} seconds."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/stale-signals"

      # ===== INFRASTRUCTURE ALERTS =====
      - alert: RedisDown
        expr: up{job="redis"} == 0
        for: 30s
        labels:
          severity: critical
          service: redis
        annotations:
          summary: "Redis is down"
          description: "Redis has been down for more than 30 seconds."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/redis-down"

      - alert: KubernetesPodCrashLooping
        expr: rate(kube_pod_container_status_restarts_total{namespace="production", pod=~"supreme-system-v5-.*"}[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
          service: kubernetes
        annotations:
          summary: "Pod crash looping"
          description: "Pod {{ $labels.pod }} is crash looping."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/pod-crash-loop"

      - alert: KubernetesHighPodRestarts
        expr: increase(kube_pod_container_status_restarts_total{namespace="production", pod=~"supreme-system-v5-.*"}[10m]) > 5
        for: 5m
        labels:
          severity: warning
          service: kubernetes
        annotations:
          summary: "High pod restart rate"
          description: "Pod {{ $labels.pod }} has restarted {{ $value | printf \"%.0f\" }} times in the last 10 minutes."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/high-pod-restarts"

      # ===== BUSINESS IMPACT ALERTS =====
      - alert: SupremeSystemZeroTrades
        expr: rate(supreme_trading_trades_total[10m]) == 0
        for: 5m
        labels:
          severity: critical
          service: supreme-system-v5
        annotations:
          summary: "Zero trades executed"
          description: "No trades have been executed in the last 10 minutes."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/zero-trades"

      - alert: SupremeSystemLowProfitFactor
        expr: supreme_trading_profit_factor < 1.2
        for: 10m
        labels:
          severity: warning
          service: supreme-system-v5
        annotations:
          summary: "Low profit factor"
          description: "Profit factor is {{ $value | printf \"%.2f\" }}, below 1.2 threshold."
          runbook_url: "https://docs.supreme-system-v5.com/runbooks/low-profit-factor"
